'use client';

import { useState } from 'react';
import { Calculator, Star, Sparkles, TrendingUp, Calendar, Clock, User, Compass, Loader2 } from 'lucide-react';

type TabType = 'bazi' | 'qimen' | 'result' | 'qimen-result';

interface BaziInput {
  name: string;
  year: number;
  month: number;
  day: number;
  hour: number;
  minute: number;
  gender: 'male' | 'female';
  calendarType: 'solar' | 'lunar';
}

interface QimenInput {
  year: number;
  month: number;
  day: number;
  hour: number;
  question: string;
  questionType: string;
}

interface BaziResult {
  siZhu?: {
    year?: { gan?: string; zhi?: string; element?: string };
    month?: { gan?: string; zhi?: string; element?: string };
    day?: { gan?: string; zhi?: string; element?: string };
    hour?: { gan?: string; zhi?: string; element?: string };
  };
  wuXing?: {
    wood?: number;
    fire?: number;
    earth?: number;
    metal?: number;
    water?: number;
  };
  shiShen?: Array<{ name?: string; strength?: string; description?: string }>;
  dayun?: Array<{
    age?: number;
    year?: number;
    gan?: string;
    zhi?: string;
    element?: string;
    fortune?: string;
  }>;
  analysis?: {
    personality?: string;
    career?: string;
    wealth?: string;
    relationship?: string;
    health?: string;
  };
}

interface QimenResult {
  panJu?: number;
  isYinDun?: boolean;
  zhiFu?: { gong?: string; xing?: string };
  zhiShi?: { gong?: string; men?: string };
  jiuGong?: Array<{
    gong?: string;
    diPan?: { gan?: string };
    tianPan?: { xing?: string; gan?: string };
    renPan?: { men?: string };
    shenPan?: { shen?: string };
    isZhiFu?: boolean;
    isZhiShi?: boolean;
  }>;
  year?: number;
  month?: number;
  day?: number;
  hour?: number;
}

export default function HomePage() {
  const [activeTab, setActiveTab] = useState<TabType>('bazi');
  const [isLoading, setIsLoading] = useState(false);

  // 八字数据
  const [baziInput, setBaziInput] = useState<BaziInput>({
    name: '',
    year: new Date().getFullYear(),
    month: 1,
    day: 1,
    hour: 0,
    minute: 0,
    gender: 'male',
    calendarType: 'solar'
  });
  const [baziResult, setBaziResult] = useState<BaziResult | null>(null);

  // 奇门数据
  const [qimenInput, setQimenInput] = useState<QimenInput>({
    year: new Date().getFullYear(),
    month: 1,
    day: 1,
    hour: new Date().getHours(),
    question: '',
    questionType: 'career'
  });
  const [qimenResult, setQimenResult] = useState<QimenResult | null>(null);

  // 处理八字计算
  const handleBaziSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      const birthDate = new Date(baziInput.year, baziInput.month - 1, baziInput.day, baziInput.hour, baziInput.minute);

      const response = await fetch('/api/bazi', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          birthDate: birthDate.toISOString(),
          gender: baziInput.gender,
          calendarType: baziInput.calendarType
        })
      });

      if (!response.ok) throw new Error('八字计算失败');

      const data = await response.json();
      setBaziResult(data);
      setActiveTab('result');

      // 获取大运
      const dayunResponse = await fetch('/api/dayun', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          birthDate: birthDate.toISOString(),
          gender: baziInput.gender
        })
      });

      if (dayunResponse.ok) {
        const dayunData = await dayunResponse.json();
        setBaziResult(prev => ({ ...prev!, dayun: dayunData }));
      }
    } catch (error) {
      console.error('计算错误:', error);
      alert('计算失败，请稍后重试');
    } finally {
      setIsLoading(false);
    }
  };

  // 处理奇门计算
  const handleQimenSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      const response = await fetch('/api/qimen/pai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          year: qimenInput.year,
          month: qimenInput.month,
          day: qimenInput.day,
          hour: qimenInput.hour
        })
      });

      if (!response.ok) throw new Error('奇门遁甲计算失败');

      const data = await response.json();
      setQimenResult(data);
      setActiveTab('qimen-result');
    } catch (error) {
      console.error('计算错误:', error);
      alert('计算失败，请稍后重试');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
      {/* 头部导航 */}
      <nav className="container mx-auto px-6 py-4">
        <div className="flex items-center space-x-2">
          <Calculator className="h-8 w-8 text-purple-600" />
          <span className="text-2xl font-bold text-gray-800">科学算命</span>
        </div>
      </nav>

      {/* 主要内容 */}
      <main className="container mx-auto px-6 py-8">
        <div className="max-w-5xl mx-auto">
          {/* Logo和Slogan */}
          {!baziResult && !qimenResult && (
            <div className="text-center mb-8">
              <Calculator className="h-16 w-16 mx-auto mb-4 text-purple-600" />
              <h1 className="text-4xl md:text-5xl font-bold text-gray-900 mb-3">
                知命而行，顺势而为
              </h1>
              <p className="text-lg text-gray-700">
                基于现代Web技术的传统八字命理系统
              </p>
            </div>
          )}

          {/* 标签页切换 */}
          <div className="flex justify-center mb-6">
            <div className="bg-white rounded-lg p-1 shadow-md">
              <button
                onClick={() => setActiveTab('bazi')}
                className={`px-6 py-2 rounded-lg transition-colors ${
                  activeTab === 'bazi' || activeTab === 'result'
                    ? 'bg-purple-600 text-white'
                    : 'text-gray-700 hover:text-purple-600'
                }`}
              >
                八字测算
              </button>
              <button
                onClick={() => setActiveTab('qimen')}
                className={`px-6 py-2 rounded-lg transition-colors ${
                  activeTab === 'qimen' || activeTab === 'qimen-result'
                    ? 'bg-purple-600 text-white'
                    : 'text-gray-700 hover:text-purple-600'
                }`}
              >
                奇门决策
              </button>
            </div>
          </div>

          {/* 加载状态 */}
          {isLoading && (
            <div className="bg-white rounded-xl shadow-xl p-12 text-center">
              <Loader2 className="h-12 w-12 text-purple-600 animate-spin mx-auto mb-4" />
              <p className="text-gray-700">正在计算中...</p>
            </div>
          )}

          {/* 八字输入表单 */}
          {!isLoading && activeTab === 'bazi' && (
            <div className="bg-white rounded-xl shadow-xl p-8">
              <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">
                八字测算信息录入
              </h2>
              <form onSubmit={handleBaziSubmit} className="space-y-6">
                {/* 姓名 */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <User className="inline h-4 w-4 mr-1" />
                    姓名（可选）
                  </label>
                  <input
                    type="text"
                    value={baziInput.name}
                    onChange={(e) => setBaziInput({ ...baziInput, name: e.target.value })}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                    placeholder="请输入姓名"
                  />
                </div>

                {/* 历法类型 */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <Calendar className="inline h-4 w-4 mr-1" />
                    历法类型
                  </label>
                  <div className="flex space-x-4">
                    <label className="flex items-center">
                      <input
                        type="radio"
                        value="solar"
                        checked={baziInput.calendarType === 'solar'}
                        onChange={(e) => setBaziInput({ ...baziInput, calendarType: e.target.value as 'solar' | 'lunar' })}
                        className="mr-2"
                      />
                      公历（阳历）
                    </label>
                    <label className="flex items-center">
                      <input
                        type="radio"
                        value="lunar"
                        checked={baziInput.calendarType === 'lunar'}
                        onChange={(e) => setBaziInput({ ...baziInput, calendarType: e.target.value as 'solar' | 'lunar' })}
                        className="mr-2"
                      />
                      农历（阴历）
                    </label>
                  </div>
                </div>

                {/* 日期时间 */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <Clock className="inline h-4 w-4 mr-1" />
                    出生时间
                  </label>
                  <div className="grid grid-cols-5 gap-3">
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">年</label>
                      <select
                        value={baziInput.year}
                        onChange={(e) => setBaziInput({ ...baziInput, year: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 211 }, (_, i) => 1900 + i).map(year => (
                          <option key={year} value={year}>{year}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">月</label>
                      <select
                        value={baziInput.month}
                        onChange={(e) => setBaziInput({ ...baziInput, month: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 12 }, (_, i) => i + 1).map(month => (
                          <option key={month} value={month}>{month}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">日</label>
                      <select
                        value={baziInput.day}
                        onChange={(e) => setBaziInput({ ...baziInput, day: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 31 }, (_, i) => i + 1).map(day => (
                          <option key={day} value={day}>{day}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">时</label>
                      <select
                        value={baziInput.hour}
                        onChange={(e) => setBaziInput({ ...baziInput, hour: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 24 }, (_, i) => i).map(hour => (
                          <option key={hour} value={hour}>{hour}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">分</label>
                      <select
                        value={baziInput.minute}
                        onChange={(e) => setBaziInput({ ...baziInput, minute: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 12 }, (_, i) => i * 5).map(minute => (
                          <option key={minute} value={minute}>{minute}</option>
                        ))}
                      </select>
                    </div>
                  </div>
                </div>

                {/* 性别 */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <User className="inline h-4 w-4 mr-1" />
                    性别
                  </label>
                  <div className="flex space-x-4">
                    <label className="flex items-center">
                      <input
                        type="radio"
                        value="male"
                        checked={baziInput.gender === 'male'}
                        onChange={(e) => setBaziInput({ ...baziInput, gender: e.target.value as 'male' | 'female' })}
                        className="mr-2"
                      />
                      男
                    </label>
                    <label className="flex items-center">
                      <input
                        type="radio"
                        value="female"
                        checked={baziInput.gender === 'female'}
                        onChange={(e) => setBaziInput({ ...baziInput, gender: e.target.value as 'male' | 'female' })}
                        className="mr-2"
                      />
                      女
                    </label>
                  </div>
                </div>

                {/* 提交按钮 */}
                <button
                  type="submit"
                  className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors"
                >
                  开始测算
                </button>
              </form>
            </div>
          )}

          {/* 八字结果 */}
          {!isLoading && activeTab === 'result' && baziResult && (
            <div className="space-y-6">
              <BaziResultDisplay result={baziResult} onReset={() => { setBaziResult(null); setActiveTab('bazi'); }} />
            </div>
          )}

          {/* 奇门输入表单 */}
          {!isLoading && activeTab === 'qimen' && (
            <div className="bg-white rounded-xl shadow-xl p-8">
              <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">
                奇门遁甲决策系统
              </h2>
              <form onSubmit={handleQimenSubmit} className="space-y-6">
                {/* 问题类型 */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">决策类型</label>
                  <select
                    value={qimenInput.questionType}
                    onChange={(e) => setQimenInput({ ...qimenInput, questionType: e.target.value })}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                  >
                    <option value="career">事业发展</option>
                    <option value="wealth">求财投资</option>
                    <option value="relationship">感情婚姻</option>
                    <option value="health">健康养生</option>
                    <option value="study">学业考试</option>
                    <option value="travel">出行搬家</option>
                    <option value="litigation">官司诉讼</option>
                    <option value="other">其他问题</option>
                  </select>
                </div>

                {/* 具体问题 */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">具体问题（可选）</label>
                  <textarea
                    value={qimenInput.question}
                    onChange={(e) => setQimenInput({ ...qimenInput, question: e.target.value })}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    rows={3}
                    placeholder="请简要描述您想要决策的问题..."
                  />
                </div>

                {/* 决策时间 */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">决策时间</label>
                  <div className="grid grid-cols-4 gap-3">
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">年</label>
                      <select
                        value={qimenInput.year}
                        onChange={(e) => setQimenInput({ ...qimenInput, year: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 10 }, (_, i) => new Date().getFullYear() - 5 + i).map(year => (
                          <option key={year} value={year}>{year}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">月</label>
                      <select
                        value={qimenInput.month}
                        onChange={(e) => setQimenInput({ ...qimenInput, month: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 12 }, (_, i) => i + 1).map(month => (
                          <option key={month} value={month}>{month}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">日</label>
                      <select
                        value={qimenInput.day}
                        onChange={(e) => setQimenInput({ ...qimenInput, day: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 31 }, (_, i) => i + 1).map(day => (
                          <option key={day} value={day}>{day}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs text-gray-500 mb-1">时</label>
                      <select
                        value={qimenInput.hour}
                        onChange={(e) => setQimenInput({ ...qimenInput, hour: parseInt(e.target.value) })}
                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                      >
                        {Array.from({ length: 24 }, (_, i) => i).map(hour => (
                          <option key={hour} value={hour}>{hour}</option>
                        ))}
                      </select>
                    </div>
                  </div>
                </div>

                {/* 提交按钮 */}
                <button
                  type="submit"
                  className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-colors"
                >
                  开始起盘决策
                </button>
              </form>
            </div>
          )}

          {/* 奇门结果 */}
          {!isLoading && activeTab === 'qimen-result' && qimenResult && (
            <div className="space-y-6">
              <QimenResultDisplay result={qimenResult} question={qimenInput.question} questionType={qimenInput.questionType} onReset={() => { setQimenResult(null); setActiveTab('qimen'); }} />
            </div>
          )}

          {/* 功能介绍 */}
          {!baziResult && !qimenResult && (
            <div className="grid md:grid-cols-3 gap-6 mb-12 mt-12">
              <FeatureCard
                icon={<Star />}
                title="精确计算"
                description="基于天文历法的严谨八字排盘，支持公历/农历"
              />
              <FeatureCard
                icon={<Sparkles />}
                title="深度分析"
                description="完整的五行分析、十神体系、天干地支关系网"
              />
              <FeatureCard
                icon={<TrendingUp />}
                title="运势指引"
                description="大运流年可视化，事业、财运、情感、健康全方位评估"
              />
            </div>
          )}
        </div>
      </main>

      {/* 页脚 */}
      <footer className="bg-gray-900 text-gray-400 py-6 mt-12">
        <div className="container mx-auto px-6 text-center">
          <p className="mb-2">© 2026 科学算命 | Powered by Next.js 14 + TypeScript</p>
          <p className="text-sm">基于传统周易数理模型，结果仅供娱乐与文化交流参考</p>
        </div>
      </footer>
    </div>
  );
}

// 八字结果展示组件
function BaziResultDisplay({ result, onReset }: { result: BaziResult; onReset: () => void }) {
  return (
    <div className="space-y-6">
      <div className="bg-white rounded-xl shadow-lg p-6">
        <h2 className="text-2xl font-bold text-gray-900 mb-4 text-center">八字命理分析报告</h2>

        {/* 四柱八字 */}
        {result.siZhu && (
          <div className="mb-6">
            <h3 className="text-lg font-bold text-gray-900 mb-3">四柱八字</h3>
            <div className="grid grid-cols-4 gap-4">
              <Pillar title="年柱" gan={result.siZhu.year?.gan} zhi={result.siZhu.year?.zhi} element={result.siZhu.year?.element} />
              <Pillar title="月柱" gan={result.siZhu.month?.gan} zhi={result.siZhu.month?.zhi} element={result.siZhu.month?.element} />
              <Pillar title="日柱" gan={result.siZhu.day?.gan} zhi={result.siZhu.day?.zhi} element={result.siZhu.day?.element} />
              <Pillar title="时柱" gan={result.siZhu.hour?.gan} zhi={result.siZhu.hour?.zhi} element={result.siZhu.hour?.element} />
            </div>
          </div>
        )}

        {/* 五行分析 */}
        {result.wuXing && (
          <div className="mb-6">
            <h3 className="text-lg font-bold text-gray-900 mb-3">五行分析</h3>
            <div className="grid grid-cols-5 gap-4">
              <ElementBar name="木" value={result.wuXing.wood || 0} color="bg-green-500" />
              <ElementBar name="火" value={result.wuXing.fire || 0} color="bg-red-500" />
              <ElementBar name="土" value={result.wuXing.earth || 0} color="bg-yellow-500" />
              <ElementBar name="金" value={result.wuXing.metal || 0} color="bg-gray-400" />
              <ElementBar name="水" value={result.wuXing.water || 0} color="bg-blue-500" />
            </div>
          </div>
        )}

        {/* 命理分析 */}
        {result.analysis && (
          <div>
            <h3 className="text-lg font-bold text-gray-900 mb-3">命理分析</h3>
            <div className="space-y-4">
              {result.analysis.personality && (
                <div className="bg-purple-50 rounded-lg p-4">
                  <h4 className="font-semibold text-purple-900 mb-1">性格特征</h4>
                  <p className="text-gray-700">{result.analysis.personality}</p>
                </div>
              )}
              {result.analysis.career && (
                <div className="bg-blue-50 rounded-lg p-4">
                  <h4 className="font-semibold text-blue-900 mb-1">事业发展</h4>
                  <p className="text-gray-700">{result.analysis.career}</p>
                </div>
              )}
              {result.analysis.wealth && (
                <div className="bg-green-50 rounded-lg p-4">
                  <h4 className="font-semibold text-green-900 mb-1">财运分析</h4>
                  <p className="text-gray-700">{result.analysis.wealth}</p>
                </div>
              )}
            </div>
          </div>
        )}
      </div>

      <button
        onClick={onReset}
        className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700"
      >
        重新测算
      </button>
    </div>
  );
}

// 奇门结果展示组件
function QimenResultDisplay({ result, question, questionType, onReset }: { result: QimenResult; question: string; questionType: string; onReset: () => void }) {
  return (
    <div className="space-y-6">
      <div className="bg-white rounded-xl shadow-lg p-6">
        <h2 className="text-2xl font-bold text-gray-900 mb-4 text-center">奇门遁甲决策盘</h2>

        {question && (
          <p className="text-center text-purple-900 mb-4">问题：{question}</p>
        )}

        {/* 盘局信息 */}
        <div className="grid grid-cols-3 gap-4 mb-6">
          <div className="bg-indigo-50 rounded-lg p-4 text-center">
            <div className="text-sm text-gray-600 mb-1">局数</div>
            <div className="text-2xl font-bold text-indigo-900">{result.panJu}局</div>
          </div>
          <div className="bg-purple-50 rounded-lg p-4 text-center">
            <div className="text-sm text-gray-600 mb-1">阴遁/阳遁</div>
            <div className="text-2xl font-bold text-purple-900">{result.isYinDun ? '阴遁' : '阳遁'}</div>
          </div>
          <div className="bg-pink-50 rounded-lg p-4 text-center">
            <div className="text-sm text-gray-600 mb-1">决策类型</div>
            <div className="text-2xl font-bold text-pink-900">{getQuestionTypeName(questionType)}</div>
          </div>
        </div>

        {/* 值符值使 */}
        <div className="grid grid-cols-2 gap-4 mb-6">
          {result.zhiFu && (
            <div className="bg-indigo-50 rounded-lg p-4">
              <h4 className="font-bold text-indigo-900 mb-2">值符</h4>
              <p>宫位：{result.zhiFu.gong}</p>
              <p>九星：{result.zhiFu.xing}</p>
            </div>
          )}
          {result.zhiShi && (
            <div className="bg-purple-50 rounded-lg p-4">
              <h4 className="font-bold text-purple-900 mb-2">值使</h4>
              <p>宫位：{result.zhiShi.gong}</p>
              <p>八门：{result.zhiShi.men}</p>
            </div>
          )}
        </div>

        {/* 九宫排盘 */}
        {result.jiuGong && result.jiuGong.length > 0 && (
          <div>
            <h3 className="text-lg font-bold text-gray-900 mb-3">九宫排盘</h3>
            <div className="grid grid-cols-3 gap-3">
              {result.jiuGong.map((gong, index) => (
                <GongCard key={index} gong={gong} index={index} />
              ))}
            </div>
          </div>
        )}
      </div>

      <button
        onClick={onReset}
        className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg hover:from-indigo-700 hover:to-purple-700"
      >
        重新起盘
      </button>
    </div>
  );
}

// 柱显示组件
function Pillar({ title, gan, zhi, element }: { title: string; gan?: string; zhi?: string; element?: string }) {
  return (
    <div className="text-center">
      <div className="text-sm text-gray-500 mb-2">{title}</div>
      <div className="bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg p-3 border border-purple-200">
        <div className="text-2xl font-bold text-purple-900 mb-1">{gan || '-'}</div>
        <div className="text-2xl font-bold text-blue-900">{zhi || '-'}</div>
        <div className="text-xs text-gray-500 mt-2">{element || ''}</div>
      </div>
    </div>
  );
}

// 五行条形图组件
function ElementBar({ name, value, color }: { name: string; value: number; color: string }) {
  const percentage = Math.min(value * 10, 100);
  return (
    <div className="text-center">
      <div className="text-lg font-bold text-gray-900 mb-2">{name}</div>
      <div className="bg-gray-200 rounded-full h-4 overflow-hidden">
        <div className={`${color} h-full transition-all`} style={{ width: `${percentage}%` }} />
      </div>
      <div className="text-sm text-gray-600 mt-1">{value}</div>
    </div>
  );
}

// 宫位卡片组件
function GongCard({ gong, index }: { gong: any; index: number }) {
  const gongColors = [
    'bg-red-50 border-red-200',
    'bg-blue-50 border-blue-200',
    'bg-green-50 border-green-200',
    'bg-yellow-50 border-yellow-200',
    'bg-purple-50 border-purple-200',
    'bg-pink-50 border-pink-200',
    'bg-indigo-50 border-indigo-200',
    'bg-orange-50 border-orange-200',
    'bg-teal-50 border-teal-200'
  ];

  return (
    <div className={`${gongColors[index]} rounded-lg p-3 border ${gong.isZhiFu || gong.isZhiShi ? 'ring-2 ring-purple-500' : ''}`}>
      <div className="flex justify-between items-start mb-2">
        <span className="font-bold text-gray-900">{gong.gong}</span>
        {(gong.isZhiFu || gong.isZhiShi) && (
          <span className="text-xs bg-purple-600 text-white px-2 py-0.5 rounded">
            {gong.isZhiFu ? '值符' : '值使'}
          </span>
        )}
      </div>
      <div className="space-y-1 text-sm">
        <div className="flex justify-between">
          <span className="text-gray-600">地：</span>
          <span className="font-semibold">{gong.diPan?.gan || '-'}</span>
        </div>
        <div className="flex justify-between">
          <span className="text-gray-600">天：</span>
          <span className="font-semibold">{gong.tianPan?.xing || '-'}</span>
        </div>
        <div className="flex justify-between">
          <span className="text-gray-600">门：</span>
          <span className={`font-semibold ${isLuckyMen(gong.renPan?.men) ? 'text-green-700' : 'text-red-700'}`}>
            {gong.renPan?.men || '-'}
          </span>
        </div>
        <div className="flex justify-between">
          <span className="text-gray-600">神：</span>
          <span className="font-semibold">{gong.shenPan?.shen || '-'}</span>
        </div>
      </div>
    </div>
  );
}

function getQuestionTypeName(type: string): string {
  const types: Record<string, string> = {
    career: '事业',
    wealth: '求财',
    relationship: '感情',
    health: '健康',
    study: '学业',
    travel: '出行',
    litigation: '官司',
    other: '其他'
  };
  return types[type] || '其他';
}

function isLuckyMen(men?: string): boolean {
  const luckyMen = ['开门', '休门', '生门'];
  return luckyMen.includes(men || '');
}

// 功能卡片组件
function FeatureCard({ icon, title, description }: { icon: React.ReactNode; title: string; description: string }) {
  return (
    <div className="bg-white rounded-xl shadow-lg p-6 transform hover:scale-105 transition-transform">
      <div className="flex flex-col items-center text-center h-full">
        <div className="text-purple-600 mb-4">
          {icon}
        </div>
        <h3 className="text-xl font-bold text-gray-900 mb-2">
          {title}
        </h3>
        <p className="text-gray-700">
          {description}
        </p>
      </div>
    </div>
  );
}
